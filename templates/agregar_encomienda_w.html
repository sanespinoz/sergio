<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- -------------------------------------------------------------------------
--------------------------------------------------------------------------------
Objetivo: Pantalla de alta de una o varias encomienda. 
Funcionalidad: Esta pantalla tiene como dato de entrada los datos cargados en las siguientes tablas.
    Tablas: Tipo_encomienda -> junto con la de usuario determinan el porecio de una encomienda. 
            usuario -> Junto a tipo de encomienda se determina el precio de cada encomienda.
                       Esta hace referencia solo al registro de COMISIONISTA -> Siendo el tipo nro 3  
            Localidad -> Referencia a esta tabla para saber las localidades de origen y de llegada.
            clientes -> Referencia a los clientes para evitar escribir todos los datos de remitente y destinatario.

Salida de la pantalla
           Escritura en las tablas:
            Encomienda -> Registra los totales de cada encomiendas a enviar, como tambien los datos del remitente y destinatario.
            detelle_encomienda -> Registra la o las encomienda despachadas con la guia.
           Impresion de Guia -> Imprime la hoja de guia dando los datos de origen, destino y el detalle de las encomienda.

Calculo de precio -> Este esta sujeto a dos parametros TIPO_ENCOMIENDA y COMISIONISTA.
    Precio  = precio (se encuentra en Tipo encomienda) + comison comisionista + comision sucursal + iva

            
--------------------------------------------------------------------------------
---------------------------------------------------------------------------- -->
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Alta de encomienda</title>
    </head>


<!-- Page styles -->
<link type='text/css' href='css/demo.css' rel='stylesheet' media='screen' />
<LINK REL="stylesheet" TYPE="text/css" HREF="css/estilos.css" /> <!-- Estilos de la tabla -->
    
<!-- ----------------------------------------------------------------------- -->
<!-- OSX Style CSS files -->
<link type='text/css' href='css/osx.css' rel='stylesheet' media='screen' />
<!-- ----------------------------------------------------------------------- -->
       
<script type="text/javascript" src="./js/jquery-1.3.2.js" ></script>                   
<script type="text/javascript" src="./js/propias.js" ></script>            
        
<script type="text/javascript">   
            //------------------------------------------------------------------
            // Asociamos las funciones a las acciones de los componentes
            //------------------------------------------------------------------
            var carg_cliente = true; // true = remitente; false = destinatario
            $(document).ready(function(){                
                $("#e_prov_remitente"      ).change(function(){dependencia_localidad_remitente();   });
                $("#e_prov_destinatario"   ).change(function(){dependencia_localidad_destinatario();});
                $("#e_tipo_encomienda"     ).change(function(){dependencia_tipo_encomienda();       });

                $("#e_encomienda_asegurada").change(function(){cambiar_estado_de_cargar_seguro();   }); // activa y desactiva el text para ingresar el seguro
                $("#b_aceptar"             ).click(function(){enviar_ventana();                     });
                $("#b_cancelar"            ).click(function(){cerrar_ventana();                     });
                $("#b_agregar_encomienda"  ).click(function(){agregar_encomienda_al_listado();      });

                $("#b_vaciar_la_tabla"     ).click(function(){vaciar_tabla()                        });
                $("#b_eliminar_encomienda" ).click(function(){eliminar_encomienda_al_listado();     });
                $("#b_buscar"              ).click(function(){buscar_clientes();                    });
                
                $("#e_alta_remitente"      ).click(function(){abrir_ventana('Alta de clientes','./abm/abm_clientes.php',400,400); });
                $("#e_alta_destinatario"   ).click(function(){abrir_ventana('Alta de clientes','./abm/abm_clientes.php',400,400); });
                
                $("#e_importe_a_asegurar"  ).blur (function(){sumar_seguro();                       });
                
                $("#e_importe_a_asegurar").attr("disabled", true); // se desabilita para habilitarlo solo si se tilda e_encomienda_asegurada            
                $("#e_precio").attr("disabled",             true); // Desabilitados definitibamente 
                $("#e_iva").attr("disabled",                true); // Desabilitados definitibamente
                $("#e_subtotal").attr("disabled",           true); // Desabilitados definitibamente

                // eventos de la busqueda de clientes
                $("#b_aceptar_clientes"    ).click(function(){seleccionar_cliente_buscado(carg_cliente); });

            })     

               //------------------------------------------------------------------
            // Activa o desactiva el TEXT de e_importe_seguro y e_importe_a_asegurar
            //  segun el estado del componente "e_encomienda_asegurada"
            //------------------------------------------------------------------           
            function cambiar_estado_de_cargar_seguro(){
                var estado = $("#e_encomienda_asegurada").attr("checked")? true : false;
                //$("#e_importe_seguro").attr("disabled",(!estado)); 
                $("#e_importe_a_asegurar").attr("disabled",!estado); 
            }
            

            //------------------------------------------------------------------
            // Determina el precio de la encomienda segun dos parametros 
            // "e_comisionista" y el "e_tipo_encomienda" completando los TEXT 
            // ocultos para el calculo del precio total.
            //------------------------------------------------------------------
            function dependencia_tipo_encomienda(){
                var id_com = $("#e_comisionista").val();
                // Si hay seleccionado un comisionista 
                if (id_com!=0) { 
                    var code = $("#e_tipo_encomienda").val();
                    // el ajax devuelve ---> 
                    //    $porc_comisionista.'|'.$comision_misionista.'|'.$porc_sucursal.'|'.$comision_sucursal.
                    //    '|'.$sub_total.'|'.$iva.'|'.$Total;                            
                    $.get("ajax_tipo_encomienda.php", { code: code, id_com: id_com },function(resultado){                   
                    if (resultado == false){
                        alert("Error llamando a tipo de encomienda");
                    }else{
                        var res1 = resultado.split("|");      
                        $('#h_com_com').attr("Value",res1[1]); // $ comision del comisionista en pesos			
                        $('#h_com_suc').attr("Value",res1[3]); // $ comision de la sucursal en Pesos
                        $('#h_iva').attr("Value",res1[5]); // $ Iva del precio
                        //--$('#sp_precio').html(res1[6]);	// total con comision comisionista , comision sucursal y el iva	
                        $('#e_sub_precio').val(res1[6]);	// total con comision comisionista , comision sucursal y el iva	
                    }});
                 }else{
                     alert("Debe seleccionar un comisionista previamente...");
                     $("#e_tipo_encomienda").val(0);
                 } 
            }     
            //------------------------------------------------------------------
            // carga el combobox "e_loc_remitente" de localidades segun la 
            // que provincia este seleccionada en e_prov_remitente
            //------------------------------------------------------------------
            function dependencia_localidad_remitente(){
                var code = $("#e_prov_remitente").val();
                var es_origen = true;
                
                $.get("ajax_localidades.php", {code:code, es_origen:es_origen},function(resultado){
			if(resultado == false){
				alert("Error llamando a localidades origen");
			}else{
				$("#e_loc_remitente").attr("disabled",false);
				document.getElementById("e_loc_remitente").options.length=0;
				$('#e_loc_remitente').append(resultado);			
			}
		});
            }    
            
            //------------------------------------------------------------------
            // carga el combobox "e_loc_destinatario" de localidades segun la 
            // que provincia este seleccionada en e_prov_destinatario
            //------------------------------------------------------------------
            function dependencia_localidad_destinatario(){
                var code = $("#e_prov_destinatario").val();
                var es_origen = false;
                
                $.get("ajax_localidades.php", { code: code, es_origen:es_origen },function(resultado){
			if(resultado == false){
				alert("Error llamando a localidades destino");
			}else{
				$("#e_loc_destinatario").attr("disabled",false);
				document.getElementById("e_loc_destinatario").options.length=0;
				$('#e_loc_destinatario').append(resultado);			
			}
		});
            }            

            //------------------------------------------------------------------
            // Verifica que los datos esten cargados correctamente antes de 
            // escribir la base
            //------------------------------------------------------------------
            function validar_carga_de_datos(){
                //Validacion 1 : Verificamos que halla tipo de encomiendas 
                //               cargadas
                if (parseFloat($("#e_precio").attr('value'))<=0){
                    alert("Aun no seleccionó la/s encomienda/s...");
                    return false;
                }
                //Validacion 2 : Verificamos si esta tildada la opcion de seguro 
                //               este cargado el monto.
                if ($("#e_encomienda_asegurada").attr('checked')==true){
                    if ($("#e_importe_seguro").attr('value')<=0){
                        alert("Debe cargar el importe del seguro...");
                        return false
                    }
                }
                // Si el procesamiento llego hasta aca estan correcto los controles
                return true;
            }
            
            //------------------------------------------
            // Cierra la ventana 
            //------------------------------------------
            function cerrar_ventana(){
                if (confirm('¿Segúro de cancelar la carga de encomienda?'))
                    window.close();
            }

            //------------------------------------------
            // Envia el contenido del formulario 	
            //------------------------------------------
            function enviar_ventana(){
                // verificamos que al hacer click en aceptar esten todos los 
                // datos cargados correctamente
                if (validar_carga_de_datos()==true)
                    if (confirm("¿Segúro de guardar la encomienda?")) {                  
            
                        var myTableArray = [];

                        $("table#t_detalle_encomienda tr").each(function() {
                            var arrayOfThisRow = [];
                            var tableData = $(this).find('td');
                            if (tableData.length > 0) {
                                tableData.each(function() { arrayOfThisRow.push($(this).text()); });
                                myTableArray.push(arrayOfThisRow);
                            }
                        });
                        
                        var parametros = {
                                    "e_fecha"              : $("#e_fecha").val(),
                                    "e_fecha_entrega"      : $("#e_fecha_entrega").val(),
                                    "e_hora_entrega_desde" : $("#e_hora_entrega_desde").val(),
                                    "e_hora_entrega_hasta" : $("#e_hora_entrega_hasta").val(),
                                    "e_prioridad"          : $("#e_prioridad").val(),
                                    "e_comisionista"       : $("#e_comisionista").val(),                                    
                                    "e_dni_destinatario"   : $("#e_dni_destinatario").val(),
                                    "e_comisionista"       : $("#e_comisionista").val(),
                                    "e_prioridad"          : $("#e_prioridad").val(),
                                    "e_dni_destinatario"   : $("#e_dni_destinatario").val(),
                                    "e_dni_remitente"      : $("#e_dni_remitente").val(),
                                    "e_remitente"          : $("#e_remitente").val(),
                                    "e_destinatario"       : $("#e_destinatario").val(),
                                    "e_dir_destinatario"   : $("#e_dir_destinatario").val(),
                                    "e_dir_remitente"      : $("#e_dir_remitente").val(),
                                    "e_prov_destinatario"  : $("#e_prov_destinatario").val(),
                                    "e_prov_remitente"     : $("#e_prov_remitente").val(),
                                    "e_loc_destinatario"   : $("#e_loc_destinatario").val(),
                                    "e_loc_remitente"      : $("#e_loc_remitente").val(),
                                    "e_tel_destinatario"   : $("#e_tel_destinatario").val(),
                                    "e_tel_remitente"      : $("#e_tel_remitente").val(),
                                    "e_comi_comi"          : $("#e_comi_comi").val(),
                                    "e_comi_suc"           : $("#e_comi_suc").val(),
                                    "e_importe_seguro"     : $("#e_importe_seguro").val(),
                                    "e_encomienda_asegurada" : $("#e_encomienda_asegurada").val(),
                                    "e_debetener_frio"       : $("#e_debetener_frio").val(),
                                    "e_con_aviso_de_retorno" : $("#e_con_aviso_de_retorno").val(),
                                    "e_subtotal"             : $("#e_subtotal").val(),
                                    "e_iva"                  : $("#e_iva").val(),
                                    "e_precio"               : $("#e_precio").val(),                                    
                                    "e_observaciones"        : $("#e_observaciones").val(),
                                    "h_subtotal"             : $("#h_subtotal").val(),     
                                    "e_detalle_encomienda"   : myTableArray
                        };
                        $.ajax({
                            data:  parametros,
                            url:   'insertar_encomienda.php',
                            type:  'post',
                            beforeSend: function () {
                                //$("#resultado").html("Procesando, espere por favor...");
                                                    },
                            success:  function (response) {
                                        alert("Se guardo correctamente...");
                                        cerrar_ventana();
                           }
                        });                        
                }
            }
            
            //------------------------------------------------------------------
            // realiza el incremento del subtotal por el importe del seguro
            //------------------------------------------------------------------
            function sumar_seguro(){
                    var subtotal = parseFloat( $('#h_subtotal').val() );
                    var porcentaje_seguro = parseFloat( $("#sp_porcentaje_seguro").html());
                    var imp_aseg = parseFloat($("#e_importe_a_asegurar").val());
                    
                    imp_aseg = parseFloat( imp_aseg * porcentaje_seguro / 100);
                   
                    var porcentaje_iva = parseFloat(($("#sp_iva").html())); 
                    var precio_iva = subtotal + (subtotal * porcentaje_iva / 100) + imp_aseg;
                    
                    $("#e_importe_seguro").val(imp_aseg.toFixed(2));
                    $('#e_subtotal').attr('value',subtotal.toFixed(2));                       
                    $('#e_iva').attr("Value",(precio_iva - subtotal).toFixed(2));                        
                    $('#e_precio').attr("Value",precio_iva.toFixed(2));                            
            }
            
            //------------------------------------------------------------------
            // Completa el listado de encomienda asociadas a la guia de encomienda.
            // accion: agrea la cantidad de tipo de encomienda. Incrementando el 
            //          total de encomienda  y calcula el iva del mismo total.
            //------------------------------------------------------------------
            function agregar_encomienda_al_listado(){
                // Si tengo ya seleccionado el "COMISIONISTA" y el "TIPO DE ENCOMIENDA"
                if (($("#e_tipo_encomienda").val()!=0)&($("#e_comisionista").val()!=0)) {                    
                    // obtenemos los datos de cantidad, tipo, precio y el iva 
                    var cant_reg = $('#e_cantidad_encomienda').val();                   
                     // obtenemos el texto seleccionado de la encomienda
                    var tipo_reg = $('#e_tipo_encomienda option:selected').html();
                    // precio unitario (precio enco + comisiones sucursal y comicionista) con iva
                    var precio_unit_reg = parseFloat($('#e_sub_precio').val()).toFixed(2);
                    // valor del iva para el registro cargado
                    var iva_reg = parseFloat($('#h_iva').val());                                           
                    // Precio total con IVA 
                    var precio_total_reg = (cant_reg * precio_unit_reg ).toFixed(2);                    
                    // precio total sin IVA
                    var precio_total_sin_iva_reg = cant_reg * (precio_unit_reg - iva_reg );   
                    
                    //----------------------------------------------------------
                    // obtenemos las constantes de porcentajes como el IVA 
                    var porcentaje_iva = parseFloat( $("#sp_iva").html());
                    //----------------------------------------------------------
                    // Obtenemos el total del listado de encomiendas y sumamos 
                    // el mismo campo, para obtener el total sin iva.
                    var h_subtotal = parseFloat($('#h_subtotal').val());                                       
                    h_subtotal += precio_total_sin_iva_reg;
                    $('#h_subtotal').val(h_subtotal);
                    
                    // sumamos el seguro si lo hay
                    var subtotal = h_subtotal;                                    
                    
                    var precio_iva = subtotal + (subtotal * porcentaje_iva / 100);
                                       
                    if ($("#e_tipo_encomienda").val()==0) {
                        alert("Debe seleccionar el tipo de encomienda....");
                    }else{
                        var strNueva_Fila='<tr bgcolor="aaeeff">'+
			                     '<td align="center">'+
                                                '<INPUT type="checkbox" NAME="chk"></input></td>'+
                                                '<td><input type="hidden" id="h_sub_com_suc" value="'+$("#h_com_suc").val()+'"></input>'+
                                                '<input type="hidden" id="h_sub_com_com" value="'+$("#h_com_com").val()+'></input>'+                        
                                             '</td>'+
                                             '<td align="center">'+cant_reg+'</td>'+
                                             '<td align="left"  >'+tipo_reg+'</td>'+                       
                                             '<td  colspan="2"> $ '+precio_total_reg.valueOf()+'</td> </tr>';
                        $('#e_subtotal').attr('value',subtotal);                       
                        $('#e_iva').attr("Value",(precio_iva - subtotal).toFixed(2));                        
                        $('#e_precio').attr("Value",precio_iva + parseFloat( $('#e_importe_seguro').val() ));
                   
                        var s1 = parseFloat($('#e_comi_sucu').val());
                        var s2 = parseFloat($('#e_comi_comi').val());
                        s1 = parseFloat($('#h_com_suc').val() + s1); 
                        s2 = parseFloat($('#h_com_com').val() + s2); 
                        $('#e_comi_sucu').html(s1);			
                        $('#e_comi_comi').html(s2);			
                                
                        // inicializamos los valores    
                        $('#e_cantidad_encomienda').attr('value',1);
                        $('#e_tipo_encomienda').val(0); // obtenemos el texto seleccionado
                        //---- $('#sp_precio').html('0'); 
                        $('#e_sub_precio').val(0); 
                        $('#h_com_suc').attr('value',0);
                        $('#h_com_com').attr('value',0);
                        $('#h_iva').attr('value',0);
                        
                        var objTabla=$('#t_detalle_encomienda').parents().get(3);
                        //agregamos la nueva fila a la tabla
                        $(objTabla).find('tbody').append(strNueva_Fila);
				
                        //si el cuerpo la tabla esta oculto (al agregar una nueva fila) lo mostramos
                        if(!$(objTabla).find('tbody').is(':visible')){
                            //le hacemos clic al titulo de la tabla, para mostrar el contenido
                            $(objTabla).find('caption').click();
                        }
                    }
                }else{
                    alert("Debe seleccionar un comisionista y un tipo de encomienda...");
                } 
                
            }   
            
            //------------------------------------------------------------------
            //------------------------------------------------------------------
            function vaciar_tabla(){
                //evento que se produce al hacer clic en el boton que elimina una tabla completamente
                //$(document).on('click','.clsEliminarTabla',function(){
                $("#t_detalle_encomienda > tbody").empty();
                        
                // Inicializamos los valores totales de moneda, comision
                $('#h_subtotal').val(0);
                $("#sp_porcentaje_seguro").html(0);              
                
                $('#e_subtotal').attr('value',0.00);                        
                $('#e_iva').attr("Value",0.00);
                $('#e_precio').attr("Value",0.00);                       
                $('#e_comi_sucu').html(0);			
                $('#e_comi_comi').html(0);			
            }
            //------------------------------------------------------------------
            // 
            //------------------------------------------------------------------
	    
            //------------------------------------------------------------------
            //------------------------------------------------------------------
	    function eliminar_encomienda_al_listado(){
               try {
                    var mensaje = "Debe seleccionar la encomienda para eliminarla...";
                    var table = document.getElementById("cuerpo_detalle_encomienda");
                    var borrado = false; // determina si se realizo el borrado
                    var rowCount = table.rows.length; // determina la cantidad de filas
                    if (rowCount>1){
                        for(var i=0; i<rowCount; i++) {
                            var row = table.rows[i];
                            var chkbox = row.cells[0].childNodes[0];
                            if((null != chkbox) && (true == chkbox.checked)) {
                                var aux = $("#e_comi_comi").val();
                                aux =  aux - $("#h_com_com").val();
                                $("#e_comi_comi").val(aux);
                                
                                var aux2 = $("#e_comi_suc").val();
                                aux2 =  aux2 - $("#h_com_suc").val();
                                $("#e_comi_suc").val(aux2);
                            
                                table.deleteRow(i);
                                rowCount--;
                                i--;
                                borrado = true;
                            }                            
                        }
                        if(!borrado)
                            alert(mensaje);
                        
                    }else{
                        var row = table.rows[0];
                        var chkbox = row.cells[0].childNodes[0];
                        if((null != chkbox) && (true == chkbox.checked)) {
                            vaciar_tabla();
                        }else{
                            alert(mensaje)
                        }
                    }
               }catch(e) {
                    alert(e);
               }                
            }

        //----------------------------------------------------------------------
        // Realiza la busqueda de clientes de lo escrito en el edit de busqueda por sql
	function buscar_clientes() {                       
                var parametros = {code : $("#e_buscar").val()};
                var tipo = true;
                $.ajax({
                           data: parametros,
                           url : 'ajax_buscar_clientes.php',
                           type: 'post',
                           beforeSend: function () {
                               $("#t_buscar").html("Procesando, espere por favor...");
                                                   },
                           success:  function (resultado) {
                                    tbuscliente = resultado.split('@|@')
                                   // alert(tbuscliente[0]);
                                    $("#t_buscar").html(tbuscliente[0]);
                                                          }
                            });                   
        };

        //------------------------------------------------------------------------------
        // devuelve lo encontrado al precionar el boton aceptar del buscador de clientes
	function seleccionar_cliente_buscado(tipo){             
                // , dni, nombre, direccion, id_loc, localidad, id_prov, provincia, tel 
                
                var res1 =  resultado.split("|"); 
                if (tipo){                        
                    $("#e_dni_remitente").val(  res1[0] );
                    $("#e_remitente").val(      res1[1] );
                    $("#e_dir_remitente").val(  res1[2] );
                    $("#e_loc_remitente").val(  res1[3] );
                    $("#e_prov_remitente").val( res1[4] );
                    $("#e_tel_remitente").val(  res1[5] );                                                                            
                 }else{
                    $("#e_dni_destinatario").val(dni);
                    $("#e_destinatario").val(nombre);
                    $("#e_dir_destinatario").val(direccion);
                    $("#e_loc_destinatario").val(localidad);
                    $("#e_prov_destinatario").val(provincia);
                    $("#e_tel_destinatario").val(tel);                                      
                }
        }
</script>
<!-- ---------------------------------------------------------------------------
 Scrip para las pantallas desplegables de busqueda de clientes
---------------------------------------------------------------------------- -->  
<script type='text/javascript' src='./js/jquery.simplemodal.js'></script>
<script type='text/javascript' src='./js/osx.js'></script>
<!-- ----------------------------------------------------------------------- -->
 

<!-- --------------------------------------------------------------------------
Scrip para el calendario de seleccion de fecha 
---------------------------------------------------------------------------- -->       
<link  href="./css/calendario.css"   type="text/css" rel="stylesheet">
    
<script src="./js/calendar.js"       type="text/javascript"></script> 
<script src="./js/calendar-es.js"    type="text/javascript"></script> 
<script src="./js/calendar-setup.js" type="text/javascript"></script> 
<!-- ----------------------------------------------------------------------- -->
        <body>
            
            <span id="resultado">
                
            </span>
                <table border="1" align="center" cellspacing="0">
                    <tr>
                        <td colspan="9" bgcolor="#FFCC33">Agregando Encomienda</td>
                    </tr>
                    <tr>
                        <td width="89" height="23" align="right" bgcolor="#FFCC33">Nro Guia</td>
                        <td width="91">{v_nro_guia}</td>
                        <td width="72" align="right" bgcolor="#FFCC33">&nbsp;</td>
                        <td width="65" align="right" bgcolor="#FFCC33">Fecha:</td>
                        <td width="132" nowrap="nowrap">
                                <input name="e_fecha" type="text" id="e_fecha" value="{v_fecha}" size="10" />
                                    <input name="calendario_desde" type="image" src="./imagenes/calendario.png" border="0" id="calendario_desde" />
                            </td>
                        <td width="127" align="right" bgcolor="#FFCC33">Estado</td>
                        <td width="89">
                            {v_estado}
                            <input name="e_estado" type="hidden" value="{v_estado}"></input>
                        </td>                        
                        <td colspan="2" width="107" align="left" valign="middle" bgcolor="#FFCC33">
                            Nro Factura
                            {v_nro_factura}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5" align="center" bgcolor="#FFCC33">Entregar durante:</td>
                        <td rowspan="2" align="right" bgcolor="#FFCC33">
                            
                                Prioridad<br>                        
                                Comicionista
                            
                        </td>
                        <td rowspan="2" colspan="3">
                            <p>
                                    <select name="e_prioridad" id="e_prioridad">
                                        {v_combobox_prioridad}
                                    </select><br>                                        
                                    
                            <select name="e_comisionista" size="1" id="e_comisionista">
                                {v_comboBox_comisionista}
                            </select>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5" align="center" bgcolor="#FFCC33">Entregada
                                <input name="e_fecha_entrega" type="text" id="e_fecha_entrega" value="{v_fecha_entrega}" size="7" />
                                <input type="image" src="./imagenes/calendario.png" border="0" name="calendario_entrega" id="calendario_entrega"                                        />
                            Desde
                                <input name="e_hora_entrega_Desde" type="text" id="e_hora_entrega_Desde" value="{v_hora_entrega_desde}" size="5" />
                            Hasta
                                <input name="e_hora_entrega_hasta" type="text" id="e_hora_entrega_Desde2" value="{v_hora_entrega_hasta}" size="5" />
                            </td>
                    </tr>
                    <tr>
                        <td align="right" bgcolor="#FFFF00">DNI:</td>
                        <td colspan="4" bgcolor="#FFFF00"><label for="e_dni_remitente"></label>
                            <input name="e_dni_remitente" type="text" id="e_dni_remitente" value="{v_dni_remitente}" size="16" />
                            
                            <input TYPE="image" SRC="./imagenes/busqueda.png" BORDER="0" name="e_buscar_remitente" id="e_buscar_remitente" class='osx buscar' />
                            <input TYPE="image" SRC="./imagenes/agregar.png" BORDER="0" name="e_alta_remitente" id="e_alta_remitente"  />
                        </td>
                        <td align="right" bgcolor="#C4FCC2">DNI</td>
                        <td colspan="3" bgcolor="#C4FCC2">
                            <input name="e_dni_destinatario" type="text" id="e_dni_destinatario" value="{v_dni_destinatario}" size="16" />
                            
                                <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                <input type="image" src="./imagenes/busqueda.png" border="0" name="e_buscar_destinatario" id="e_buscar_destinatario" value="Buscar" class='osx buscar'/>
                                <input TYPE="image" SRC="./imagenes/agregar.png" BORDER="0" name="e_alta_destinatario" id="e_alta_destinatario" />
                                </a>
                            </td>
                    </tr>
                    <tr>
                        <td align="right" bgcolor="#FFFF00">Remitente</td>
                        <td colspan="4" bgcolor="#FFFF00"><input name="e_remitente" type="text" id="e_remitente" value="{v_remitente}" size="50" /></td>
                        <td align="right" bgcolor="#C4FCC2">Destinatario</td>
                        <td colspan="3" bgcolor="#C4FCC2"><input name="e_destinatario" type="text" id="e_destinatario" value="{v_destinatario}" size="50" /></td>
                    </tr>
                    <tr>
                        <td align="right" bgcolor="#FFFF00">Direccion</td>
                        <td colspan="4" bgcolor="#FFFF00"><input name="e_dir_remitente" type="text" id="e_dir_remitente" value="{v_dir_remitente}" size="50" /></td>
                        <td align="right" bgcolor="#C4FCC2">Direccion</td>
                        <td colspan="3" bgcolor="#C4FCC2"><input name="e_dir_destinatario" type="text" id="e_dir_destinatario" value="{v_dir_destinatario}" size="50" /></td>
                    </tr>
                    <tr>
                        <td align="right" bgcolor="#FFFF00">Provincia</td>
                        <td colspan="2" align="left" bgcolor="#FFFF00"><label for="l_loc_remitente">
                                    
                                    <select name="e_prov_remitente" id="e_prov_remitente">

                                        {v_combobox_prov_origen}
                                        
                                    </select>
                                    
                                </label></td>
                        <td align="right" bgcolor="#FFFF00">Localidad</td>
                        <td bgcolor="#FFFF00">
                        
                                    <select name="e_loc_remitente" id="e_loc_remitente">

                                        {v_combobox_loc_remitente}

                                    </select>
                            
                        </td>
                        <td align="right" bgcolor="#C4FCC2">Provincia</td>
                        <td bgcolor="#C4FCC2">
                            
                            <select name="e_prov_destinatario" id="e_prov_destinatario">
                                   {v_combobox_prov_destino}
                            </select>
                            
                        </td>
                        <td align="right" bgcolor="#C4FCC2">Localidad</td>
                        <td bgcolor="#C4FCC2">

                            <select name="e_loc_destinatario" id="e_loc_destinatario">
                                {v_combobox_loc_destinatario}
                            </select>
                            
                        </td>
                    </tr>
                    <tr>
                        <td align="right" bgcolor="#FFFF00">Tel:</td>
                        <td colspan="4" bgcolor="#FFFF00"><input name="e_tel_remitente" type="text" id="e_tel_remitente" value="{v_tel_remitente}" size="16" /></td>
                        <td align="right" bgcolor="#C4FCC2">Tel:</td>
                        <td colspan="3" bgcolor="#C4FCC2"><input name="e_tel_destinatario" type="text" id="e_tel_destinatario" value="{v_tel_destinatario}" size="16" /></td>
                    </tr>
                    
                    <tr>
                        <td colspan="12">
                            <div id="divContenedorTabla" align="center">
                                
                            <table id="t_detalle_encomienda" border="1" align="center" cellspacing="0">
				
                                <thead>
                                    <tr>
                                        <th colspan="4">                                                       
                                            Cantidad:
                                            <input name="e_cantidad_encomienda" type="text" id="e_cantidad_encomienda" value="1" size="1" />
                                            Tipo encomienda:                                    
                                            <select name="e_tipo_encomienda" id="e_tipo_encomienda">
                                                {v_comboBox_tipo_encomienda}
                                            </select>
                                            Precio:
                                            <!--<span id="sp_precio">                                            
                                               $ 0.00
                                            </span>-->
                                            <input type="text" id="e_sub_precio" value="0.00" disabled="true" size="10"></input>
                                            
                                            <input type="hidden" id="h_subtotal" value="0"> </input>
                                            <input type="hidden" id="h_com_suc" value="0">  </input>
                                            <input type="hidden" id="h_com_com" value="0">  </input>
                                            <input type="hidden" id="h_iva" value="0">      </input>
                                        </th>
                                        <th >
                                                <input TYPE="image" SRC="./imagenes/agregar.png" 
                                                   BORDER="0" name="b_agregar_encomienda" 
                                                   id="b_agregar_encomienda" 
                                                   value="Agregar" />                                                                                    
                                                <input TYPE="image" SRC="./imagenes/eliminar.png" 
                                                   BORDER="0" name="b_eliminar_encomienda" id="b_eliminar_encomienda" value="-" />
                                                <input type="image" src="./imagenes/vaciar_tabla.png" value="Vaciar la tabla" id="b_vaciar_la_tabla">                                           
                                        </th>
                                    </tr>                                   
                                    <tr  bgcolor="aaaaff" align="center">
                                        <th>
                                            
                                        </th>                                        
                                        
                                        <th bgcolor="">Cantidad</th>
                                        <th>Tipo encomienda</th>
                                        <th colspan="3">Precio</th>
                                    </tr>
                                </thead>
                                
                                <tbody id="cuerpo_detalle_encomienda">
                                </tbody>
                                
                                <tfoot>
                                    
                                </tfoot>
                            </table>
                            </div>                            
                        </td>
                    </tr>

                    
                    
                    
                    <tr>
                        <td align="left" valign="middle" bgcolor="#FFCC33">
                            Comisiones
                        </td>
                        <td colspan="3" align="left" valign="middle" bgcolor="#FFCC33">
                            sucursal: $
                            <span name="e_comi_suc" id="e_comi_suc"/>{v_comision_sucursal}
                        </td>
                        <td colspan="2" align="left" valign="middle" bgcolor="#FFCC33">
                            comisionista: $
                            <span name="e_comi_comi" id="e_comi_comi" />{v_comision_comisionista}
                        </td>
                        
                        <td colspan="3" align="left" valign="middle" bgcolor="#FFCC33">
                            Asegurar por: $      
                            <input name="e_importe_a_asegurar" type="text" id="e_importe_a_asegurar" disabled="true" value="{e_importe_a_asegurar}" size="5" />
                            <span id="sp_porcentaje_seguro">{v_porcentaje_para_asegurar}</span> % :
                        <input name="e_importe_seguro" type="text" id="e_importe_seguro" disabled="true" value="{v_importe_seguro}" size="10" />
                        </td>
                    </tr>
                    <tr>
                        <td height="39" align="right" bgcolor="#FFCC33">Encomienda</td>
                        <td height="39" colspan="5">

                            Asegurada:
                            <input name="e_encomienda_asegurada"  type="checkbox" id="e_encomienda_asegurada" accesskey="debe_tener_frio" value="{v_encomienda_asegurada}" />

                            Debe tener frio:
                            <input name="e_debetener_frio" type="checkbox" id="e_debetener_frio" accesskey="debe_tener_frio" value="{v_debe_tener_frio}" />

                            Con aviso de retorno:
                            <input name="e_con_aviso_de_retorno" type="checkbox" id="e_con_aviso_de_retorno" accesskey="con_aviso_retorno" value="{v_con_aviso_de_retorno}" />
                        </td>

                        </td>


                        <td colspan="3" align="right" valign="middle" bgcolor="#FFCC33">    	  
                            SubTotal:<input name="e_subtotal" type="text" id="e_subtotal" value="{v_subtotal}" size="16" /><br>
                                IVA % <span id="sp_iva">{v_porcentaje_iva}</span>:<input name="e_iva" type="text" id="e_iva" value="{v_iva}" size="16" /><br>
                            TOTAL:<input name="e_precio" type="text" id="e_precio" value="{v_precio_total}" size="16" />                           
                        </td>
                    </tr>
                    <tr>
                        <td height="39" align="right" bgcolor="#FFCC33">Observación:</td>
                        <td height="39" colspan="8"><textarea name="e_observaciones" id="e_observaciones" rows="4" cols="100" >{v_observaciones}</textarea></td>
                        </td>
                    </tr>
                </table>

                <!-- 
                --------------------------------------------------------------------------------
                -------------   Botonera de mando ----------------------------------------------
                -------------------------------------------------------------------------------- 
                -->

                <table id='mandos' width="21%" border="0" align="center" cellspacing="0">
                    <tr align="center" valign="middle">
                        <td>                                       
                            <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                <input id="b_aceptar" TYPE="image" SRC="./imagenes/ok.png" BORDER="0" name="b_aceptar" value="Aceptar"/>
                            </a>
                             Aceptar
                        </td>
                        <td valign="middle">&nbsp;</td>
                        <td>
                            <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                <input TYPE="image" SRC="./imagenes/cancelar.gif" BORDER="0" name="b_cancelar" id="b_cancelar" value="cancelar" click="cerrar_ventana();" />
                            </a>
                             Cancelar
                        </td>
                    </tr>	
                </Table>
                
<!--                            </form> -->


<!-- ---------------------------------------------------------------------------
--------------------------------------------------------------------------------
Sextor de POPUP de busqueda de clientes
--------------------------------------------------------------------------------
---------------------------------------------------------------------------- -->
<div id="osx-modal-content">
    <div id="osx-modal-title">Buscandor de Clientes...</div>
    <div class="close"><a href="#" class="simplemodal-close">x</a></div>
    <div id="osx-modal-data">
	<h2>Buscar</h2>
        <input name="e_buscar" type="text"  id="e_buscar" size="15" />
        <input name="b_buscar" type="image" src="./imagenes/busqueda.png" id="b_buscar" />
        
        <!-- Sector de grilla -->
        <span id="t_buscar"></span>

	<p> <!--
            <button id="b_aceptar_cliente"  class="simplemodal-close" >Aceptar</button> 
            <button id="b_cancelar_clientes" class="simplemodal-close">Cancelar</button> <span>(Presione ESC para cancelar)</span>
            -->
            <input type="image" class="simplemodal-close" src="./imagenes/ok.png"       id="b_aceptar_cliente"  size="15" />Aceptar
            <input type="image" class="simplemodal-close" src="./imagenes/cancelar.gif" id="b_cancelar_clientes" />Cancelar   <span>(Presione ESC para cancelar)</span>

        </p>
    </div>
</div>

</body>
</html>


